<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japan MakerË®∫Êñ≠ - Ë®∫Êñ≠ÁµêÊûú</title>
    <link rel="stylesheet" href="style-for-jm.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .result-container { max-width:680px; margin:40px auto; padding:24px; background:#0D0D0D; }
        .result-header { background:#1A1A1A; border:2px solid #2A2A2A; padding:28px 20px; text-align:center; border-radius:12px; margin-bottom:30px; }
        .result-header h1 { font-size:2rem; color:#E8E8E8; font-weight:700; margin-bottom:10px; }
        .result-header .subtitle { font-size:1.15rem; color:#A0A0A0; }
        .main-type-box { background:#1A1A1A; border:2px solid #2A2A2A; padding:22px 24px; margin:26px 0; border-radius:12px; }
        .main-type-name { text-align:center; font-size:1.5rem; font-weight:bold; color:#E8E8E8; margin-bottom:12px; }
        .section-title { font-size:1.2rem; color:#E8E8E8; font-weight:600; margin:20px 0 14px 0; padding-bottom:8px; border-bottom:2px solid #2A2A2A; }
        .bar-row { margin-bottom:16px; }
        .bar-label { font-size:1.05rem; font-weight:600; color:#E8E8E8; margin-bottom:6px; }
        .bar-bg { background:#232324; border-radius:8px; height:24px; width:100%; }
        .bar-fill { height:24px; border-radius:8px; background:linear-gradient(90deg,#667eea,#764ba2); transition:width 0.8s; }
        .bar-fill.top { background:linear-gradient(90deg,#E8E8E8,#A0A0A0); }
        .pie-wrapper { margin:30px auto; text-align:center; }
        #pieChart { max-width:280px; margin:0 auto; }
        .diagnosis-id-box { margin:30px 0; padding:14px; background:#1A1A1A; border-radius:8px; color:#A0A0A0; font-size:0.96rem; }
        .diagnosis-id-box code { background:#2A2A2A; color:#E8E8E8; padding:4px 10px; border-radius:4px; font-family:monospace; font-weight:600; }
        .footer { text-align:center; color:#A0A0A0; font-size:0.88rem; margin-top:30px; padding-top:18px; border-top:1px solid #232324; }
    </style>
</head>
<body>
<div class="result-container">
    <div class="result-header">
        <h1>Ë®∫Êñ≠ÂÆå‰∫Ü</h1>
        <p class="subtitle">„ÅÇ„Å™„Åü„ÅÆÈÅì„ÅåË®∫Êñ≠„Åï„Çå„Åæ„Åó„Åü</p>
    </div>
    
    <div class="main-type-box">
        <div class="main-type-name" id="typeDisplay">Ë™≠Ëæº‰∏≠...</div>
    </div>
    
    <div class="section-title">üìä „ÅÇ„Å™„Åü„ÅÆ„Çø„Ç§„ÉóÂàÜÂ∏É</div>
    <div id="barGauges"></div>
    
    <!--div class="pie-wrapper">
        <canvas id="pieChart"></canvas>
    </div-->
    
    <div class="diagnosis-id-box">
        <strong>Ë®∫Êñ≠ID:</strong> <code id="diagnosisId"></code>
    </div>
    
    <div class="footer">
        <p>¬© Japan MakerË®∫Êñ≠ All rights reserved.</p>
    </div>
</div>

<script>
(async function() {
    const url = new URL(window.location.href);
    const diagnosisId = url.searchParams.get('id');
    if (!diagnosisId) {
        document.body.innerHTML = "<div style='color:#fa4;padding:40px;text-align:center;background:#0D0D0D;'>Ë®∫Êñ≠ID„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</div>";
        return;
    }
    document.getElementById('diagnosisId').textContent = diagnosisId;
    
    const response = await fetch('https://x-sennin.com/api/japanmaker_diagnosis/get.php?id=' + diagnosisId);
    const data = await response.json();
    if(data.status !== 'success') {
        alert('„Ç®„É©„Éº: ' + data.message);
        return;
    }
    
    const result = data.result;
    document.getElementById('typeDisplay').textContent = '' + result.displayPath;
    
    const typeNames = result.typeNames;
    const percentages = result.percentages;
    let maxPercent = 0, topKey = '';
    Object.entries(percentages).forEach(([cat, percent]) => {
        if (percent >= maxPercent) { maxPercent = percent; topKey = cat; }
    });
    
    const barParent = document.getElementById('barGauges');
    Object.entries(percentages).forEach(([cat, percent]) => {
        const isTop = (cat === topKey);
        barParent.innerHTML += `
        <div class="bar-row">
            <div class="bar-label">${typeNames[cat]}</div>
            <div class="bar-bg">
                <div class="bar-fill ${isTop?'top':''}" style="width:${percent}%;"></div>
            </div>
        </div>`;
    });
    
    const pieLabels = Object.keys(percentages).map(k => typeNames[k]);
    const pieData = Object.values(percentages);
    const pieColors = ['#667eea','#E8E8E8','#A0A0A0','#764ba2','#2A2A2A'];
    const ctx = document.getElementById('pieChart');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: pieLabels,
            datasets: [{
                data: pieData,
                backgroundColor: pieColors,
                borderWidth: 2,
                borderColor: '#232324'
            }]
        },
        options: {
            plugins: { legend: { display: false }, tooltip: { enabled: false } },
            cutout: '65%',
            animation: { duration: 1200 }
        }
    });
})();
</script>
</body>
</html>
