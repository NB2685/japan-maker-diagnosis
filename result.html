<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Japan MakerË®∫Êñ≠ - Ë®∫Êñ≠ÁµêÊûú</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Brand (JM) */
    :root{
      --primary-blue:#1B5E9E;
      --dark-blue:#0A3A66;
      --light-blue:#E8F0F7;
      --text:#333333;
      --text-sub:#666666;
      --track-strong:#E0F2F7;
      --track-strong-bd:#B3E0EB;
      --track-soft:#E8F4F8;
      --track-soft-bd:#C9E6F0;
    }

    body{ background:#FFFFFF; color:var(--text);
      font-family:'Noto Sans JP','Hiragino Kaku Gothic ProN','Meiryo',Arial,sans-serif; margin:0; }

    .result-container{ max-width:680px; margin:40px auto; padding:24px; background:#FFFFFF; }

    /* Header */
    .result-header{
      background:var(--light-blue); border:2px solid var(--primary-blue);
      padding:28px 20px; text-align:center; border-radius:12px; margin-bottom:30px;
      color:var(--dark-blue);
    }
    .result-header h1{ font-size:2rem; color:var(--primary-blue); font-weight:700; margin-bottom:10px; }
    .result-header .subtitle{ font-size:1.05rem; color:var(--dark-blue); }

    /* Main type */
    .main-type-box{
      background:#FFFFFF; border:2px solid var(--light-blue);
      padding:22px 24px; margin:26px 0; border-radius:12px;
      box-shadow:0 2px 8px rgba(27,94,158,0.08);
    }
    .main-type-name{ text-align:center; font-size:1.4rem; font-weight:800; color:var(--primary-blue); margin-bottom:2px; }

    /* Section title */
    .section-title{
      font-size:1.1rem; color:var(--primary-blue); font-weight:700;
      margin:20px 0 14px 0; padding-bottom:8px; border-bottom:2px solid var(--light-blue);
    }

    /* Bars */
    .bar-row{ margin-bottom:14px; }
    .bar-label{ font-size:0.95rem; font-weight:600; color:var(--text); margin-bottom:6px; display:flex; justify-content:space-between; }
    .bar-label .val{ font-size:0.9rem; color:var(--text-sub); font-weight:600; }
    .bar-label.top{ color:var(--dark-blue); font-weight:700; }
    .bar-label.top .val{ color:var(--primary-blue); }

    .bar-bg{
      background:var(--track-soft); border:1px solid var(--track-soft-bd);
      border-radius:8px; overflow:hidden; height:24px; width:100%;
      box-shadow:0 1px 3px rgba(0,0,0,0.06);
    }
    .bar-bg.strong{
      background:var(--track-strong); border:1px solid var(--track-strong-bd);
      height:28px; box-shadow:0 1px 3px rgba(0,0,0,0.08);
    }

    .bar-fill{ height:100%; border-radius:6px;
      background:linear-gradient(90deg,#20C997,#6DD5B9); /* ÈÄöÂ∏∏: „ÉÜ„Ç£„Éº„É´ */
      transition:width 0.8s;
    }
    .bar-fill.top{
      background:linear-gradient(90deg,#17A2B8,#5DADE2); /* „Éà„ÉÉ„ÉóÔºö„Çø„Éº„Ç≥„Ç§„Ç∫ */
    }

    /* Pie (optional) */
    .pie-wrapper{ margin:30px auto; text-align:center; }
    #pieChart{ max-width:280px; margin:0 auto; }

    /* Diagnosis meta */
    .diagnosis-id-box{
      margin:30px 0; padding:14px; background:#F7FBFF; border-radius:8px;
      color:var(--text-sub); font-size:0.96rem; border:1px solid #E0EDF7;
    }
    .diagnosis-id-box code{
      background:var(--light-blue); color:var(--primary-blue);
      padding:4px 10px; border-radius:4px; font-family:monospace; font-weight:700; border:1px solid #C9DDF0;
    }

    .footer{
      text-align:center; color:var(--text-sub); font-size:0.88rem; margin-top:30px;
      padding-top:18px; border-top:1px solid var(--light-blue);
    }

    /* Small */
    @media (max-width:480px){
      .result-container{ padding:18px; margin:24px auto; }
      .result-header h1{ font-size:1.6rem; }
      .main-type-name{ font-size:1.25rem; }
    }



/* IDÊäò„ÇäËøî„Åó */
#diagnosisId{
  overflow-wrap: break-word;
  word-wrap: break-word;
}


  </style>
</head>
<body>
<div class="result-container">
  <div class="result-header">
    <h1>Ë®∫Êñ≠ÂÆå‰∫Ü</h1>
    <p class="subtitle">„ÅÇ„Å™„Åü„ÅÆÈÅì„ÅåË®∫Êñ≠„Åï„Çå„Åæ„Åó„Åü</p>
  </div>

  <div class="main-type-box">
    <div class="main-type-name" id="typeDisplay">Ë™≠Ëæº‰∏≠...</div>
  </div>

  <div class="section-title">üìä „ÅÇ„Å™„Åü„ÅÆ„Çø„Ç§„ÉóÂàÜÂ∏É</div>
  <div id="barGauges"></div>

  <!-- Optional
  <div class="pie-wrapper">
    <canvas id="pieChart"></canvas>
  </div>
  -->

  <div class="diagnosis-id-box">
    <strong>Ë®∫Êñ≠ID:</strong> <code id="diagnosisId"></code>
  </div>

  <div class="footer">
    <p>¬© Japan MakerË®∫Êñ≠ All rights reserved.</p>
  </div>
</div>

<script>
(async function(){
  const url = new URL(window.location.href);
  const diagnosisId = url.searchParams.get('id');
  if(!diagnosisId){
    document.body.innerHTML =
      "<div style='color:#0A3A66;padding:40px;text-align:center;background:#FFFFFF;border:2px solid #E8F0F7;border-radius:12px;max-width:680px;margin:40px auto;'>Ë®∫Êñ≠ID„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</div>";
    return;
  }
  document.getElementById('diagnosisId').textContent = diagnosisId;

  const response = await fetch('https://x-sennin.com/api/japanmaker_diagnosis/get.php?id='+diagnosisId);
  const data = await response.json();
  if(data.status !== 'success'){ alert('„Ç®„É©„Éº: '+data.message); return; }

  const result = data.result;
  document.getElementById('typeDisplay').textContent = '' + result.displayPath;

  const typeNames = result.typeNames;
  const percentages = result.percentages;

  // „Éà„ÉÉ„ÉóÂà§ÂÆöÔºàÊúÄÂ§ß%Ôºâ
  let maxPercent = -1, topKey = '';
  Object.entries(percentages).forEach(([cat, percent])=>{
    if(percent > maxPercent){ maxPercent = percent; topKey = cat; }
  });

  const barParent = document.getElementById('barGauges');
  Object.entries(percentages).forEach(([cat, percent])=>{
    const isTop = (cat === topKey);
    const labelClass = isTop ? 'bar-label top' : 'bar-label';
    const trackClass = isTop ? 'bar-bg strong' : 'bar-bg';
    const fillClass = isTop ? 'bar-fill top' : 'bar-fill';

    barParent.innerHTML += `
      <div class="bar-row">
        <div class="${labelClass}">
          <span>${typeNames[cat]}</span>
          <span class="val">${Number(percent).toFixed(1)}%</span>
        </div>
        <div class="${trackClass}">
          <div class="${fillClass}" style="width:${percent}%;"></div>
        </div>
      </div>`;
  });

  // ÂÜÜ„Ç∞„É©„ÉïÔºàÂøÖË¶Å„Å™„ÇâÊúâÂäπÂåñÔºâ
  /*
  const pieLabels = Object.keys(percentages).map(k => typeNames[k]);
  const pieData = Object.values(percentages);
  const pieColors = ['#17A2B8','#20C997','#5DADE2','#6DD5B9','#85C1E9'];
  const ctx = document.getElementById('pieChart');
  new Chart(ctx, {
    type:'doughnut',
    data:{
      labels: pieLabels,
      datasets:[{
        data: pieData,
        backgroundColor: pieColors,
        borderWidth: 2,
        borderColor: '#E8F0F7'
      }]
    },
    options:{
      plugins:{ legend:{ display:false }, tooltip:{ enabled:false } },
      cutout:'65%',
      animation:{ duration:1200 }
    }
  });
  */
})();
</script>
</body>
</html>
